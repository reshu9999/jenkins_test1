import tempfile
import csv
import socket,struct
import netaddr
from datetime import datetime
start_time = datetime.now()
# do your work here


""" Following IP Addreses will be tried 
1.39.0.188         	Country "IN" State "Delhi" City "New Delhi"
183.87.173.172		Country "IN" State "Maharashtra" City "Mumbai"
23.96.208.137
92.96.238.80
103.21.127.60
116.74.132.14
1.22.8.24
104.32.171.200
"""
#unique_ip = set([u'118.102.249.3', u'67.182.143.209', u'66.249.79.106', u'66.249.79.123', u'10.20.30.10', u'66.249.67.123', u'66.249.75.11', u'14.139.97.234', u'120.61.51.207', u'120.61.15.13', u'66.249.79.131', u'66.249.67.98', u'1.39.0.51', u'14.141.196.18', u'66.249.65.65', u'216.218.206.66', u'66.249.64.51', u'66.249.64.38', u'66.249.64.39', u'66.249.75.202', u'66.249.65.69', u'66.249.64.30', u'103.226.243.57', u'66.249.65.67', u'66.249.64.34', u'10.80.0.1', u'66.249.64.167', u'66.249.79.114', u'66.249.79.115', u'111.125.219.234', u'59.184.34.90', u'14.139.97.84', u'66.249.79.98', u'66.249.65.32', u'120.62.170.127', u'91.236.75.92', u'66.249.67.131', u'193.189.117.62', u'66.249.75.27', u'66.249.75.218', u'66.249.67.115', u'103.21.127.60', u'120.61.52.75', u'66.249.64.43', u'74.82.47.2', u'74.82.47.3', u'10.20.30.14', u'66.249.75.235', u'66.249.75.234', u'108.175.8.214', u'95.215.46.26', u'10.20.30.6', u'124.155.247.196', u'66.249.67.114'])

unique_ip=['1.22.89.11', '1.22.146.223', '1.22.182.179', '1.22.204.211', '1.23.15.62', '1.23.162.98', '1.23.191.90', '1.23.246.199', '1.39.12.219', '1.39.12.241', '1.39.13.137', '1.39.13.182', '1.39.14.154', '1.39.15.125', '1.39.21.69', '1.39.21.222', '1.39.33.215', '1.39.34.194', '1.39.35.139', '1.39.39.40', '1.39.46.181', '1.39.47.78', '1.39.50.147', '1.39.60.61', '1.39.61.85', '1.39.61.148', '1.39.62.77', '1.39.63.57', '1.39.84.114', '1.39.84.164', '1.39.85.42', '1.39.85.139', '1.39.85.156', '1.39.87.82', '1.39.96.29', '1.39.96.84', '1.39.98.83', '1.39.98.181', '1.39.99.1', '1.39.99.6', '1.39.99.82', '1.39.99.121', '1.39.99.218', '1.39.101.66', '1.186.37.59', '1.186.77.18', '1.186.77.25', '1.186.167.16', '1.187.91.18', '1.187.91.184', '1.187.141.159', '14.33.107.62', '14.96.17.199', '14.96.46.119', '14.97.43.79', '14.97.43.97', '14.97.45.159', '14.97.145.32', '14.97.204.198', '14.98.141.29', '14.99.97.45', '14.102.32.4', '14.139.85.195', '14.139.97.84', '14.139.97.234', '14.139.122.98', '14.139.125.71', '14.139.162.2', '14.139.181.178', '14.139.187.66', '14.139.209.3', '14.139.214.162', '14.139.219.242', '14.139.219.247', '14.139.220.82', '14.139.230.114', '14.139.231.7', '14.139.238.162', '14.139.241.85', '14.139.243.10', '14.139.244.194', '14.139.244.210', '14.139.249.201', '14.139.250.83', '14.139.250.94', '14.139.250.211', '14.139.254.36', '14.140.53.210', '14.140.125.38', '14.141.132.162', '14.142.16.50', '14.142.19.86', '14.194.92.216', '14.195.185.67', '27.4.123.163', '27.4.144.6', '27.5.65.213', '27.5.181.120', '27.6.46.194', '27.6.58.66', '27.49.69.13', '27.49.72.135', '27.54.163.68', '27.54.181.182', '27.54.181.185', '27.58.9.191', '27.58.14.67', '27.58.17.1', '27.58.35.64', '27.58.50.69', '27.58.51.134', '27.58.51.194', '27.58.52.14', '27.58.147.182', '27.58.160.161', '27.58.164.80', '27.58.172.26', '27.58.173.183', '27.59.31.74', '27.59.44.100', '27.63.168.249', '27.97.34.62', '27.97.36.175', '27.97.44.62', '27.97.44.159', '27.97.66.242', '27.97.77.31', '27.97.133.227', '27.97.146.107', '27.97.147.126', '27.97.148.169', '27.97.154.109', '27.97.159.77', '27.97.159.204', '27.97.177.140', '27.97.218.58', '27.106.3.240', '27.106.95.222', '27.107.228.38', '27.107.232.150', '27.251.59.154', '27.251.59.155', '42.104.77.147', '43.225.0.46', '43.227.21.38', '43.227.133.227', '43.248.73.6', '43.250.121.103', '43.251.168.39', '43.252.193.2', '45.115.106.41', '45.116.115.19', '45.116.126.18', '45.127.106.179', '49.14.13.122', '49.14.81.193', '49.15.12.200', '49.15.81.26', '49.15.168.115', '49.15.174.40', '49.15.184.141', '49.15.184.207', '49.15.190.127', '49.15.192.248', '49.32.0.144', '49.32.4.31', '49.32.4.199', '49.32.24.91', '49.32.36.170', '49.201.92.150', '49.202.35.15', '49.202.55.54', '49.202.106.195', '49.203.200.172', '49.204.185.106', '49.204.229.200', '49.204.229.234', '49.204.230.84', '49.204.231.42', '49.205.232.15', '49.206.202.31', '49.206.203.114', '49.207.23.217', '49.207.224.2', '49.248.55.96', '49.248.112.42', '49.249.96.240', '49.249.155.45', '58.68.121.67', '59.88.22.101', '59.88.89.123', '59.88.92.150', '59.88.147.156', '59.88.152.52', '59.88.155.3', '59.88.160.46', '59.89.248.182', '59.91.31.7', '59.91.141.86', '59.91.160.84', '59.92.227.208', '59.93.106.144', '59.93.196.104', '59.93.216.185', '59.93.221.126', '59.94.42.114', '59.94.192.171', '59.94.248.164', '59.95.81.162', '59.95.162.72', '59.95.172.72', '59.95.188.139', '59.95.188.144', '59.95.188.206', '59.95.214.25', '59.96.119.157', '59.97.153.38', '59.98.67.146', '59.98.141.76', '59.98.214.176', '59.99.72.179', '59.99.132.164', '59.144.109.218', '59.161.36.14', '59.161.38.0', '59.161.86.65', '59.162.181.77', '59.180.38.93', '59.182.203.19', '59.183.3.228', '59.185.243.2', '60.243.18.251', '61.0.30.43', '61.0.42.153', '61.0.60.13', '61.0.62.112', '61.0.170.104', '61.0.228.98', '61.0.253.185', '61.3.101.234', '61.3.111.99', '61.16.128.186', '65.49.14.83', '70.39.186.211', '101.56.189.35', '101.57.71.77', '101.57.112.124', '101.58.199.139', '101.61.118.20', '101.63.162.253', '101.63.179.156', '101.63.231.100', '101.63.236.72', '101.212.84.93', '101.222.161.212', '101.222.179.8', '101.222.223.217', '101.222.224.11', '101.222.229.138', '101.222.229.147', '101.223.218.184', '103.4.222.2', '103.9.12.122', '103.9.12.123', '103.10.24.194', '103.15.62.178', '103.15.62.181', '103.15.62.210', '103.15.63.36', '103.19.128.160', '103.19.226.69', '103.22.173.67', '103.24.127.4', '103.25.44.42', '103.28.157.45', '103.40.80.3', '103.48.181.173', '103.50.76.186', '103.51.149.39', '103.53.52.34', '103.59.206.208', '103.62.56.177', '103.194.27.27', '103.225.100.51', '103.225.204.146', '103.226.31.124', '103.228.76.148', '103.228.76.150', '103.228.140.222', '103.229.27.30', '103.230.222.98', '103.231.218.234', '103.233.116.22', '103.240.171.13', '103.240.207.105', '103.246.65.130', '103.249.42.172', '103.251.60.12', '103.252.6.16', '103.253.211.186', '104.236.251.167', '106.51.17.4', '106.51.17.103', '106.51.30.219', '106.51.129.91', '106.51.135.242', '106.66.161.114', '106.66.196.231', '106.66.200.43', '106.66.217.74', '106.66.221.169', '106.67.77.178', '106.76.24.48', '106.76.152.208', '106.76.223.41', '106.76.255.227', '106.77.9.56', '106.77.13.27', '106.77.32.241', '106.77.64.32', '106.77.162.45', '106.77.190.123', '106.78.174.115', '106.79.50.68', '106.79.140.127', '106.79.153.217', '106.79.155.17', '106.79.160.185', '106.79.162.225', '106.79.217.79', '106.194.42.55', '106.208.138.166', '106.215.166.134', '106.216.188.227', '106.219.0.104', '106.219.9.12', '106.219.24.160', '106.220.117.103', '106.220.117.218', '106.220.169.228', '106.221.142.149', '106.221.147.10', '106.221.150.182', '106.221.155.64', '106.221.155.130', '106.221.157.86', '107.167.104.185', '107.167.107.3', '107.167.107.32', '107.167.107.64', '107.167.107.137', '107.167.108.199', '107.167.109.60', '107.167.109.85', '107.167.109.184', '110.224.208.146', '111.91.75.63', '111.91.86.182', '111.93.35.167', '111.93.64.186', '111.93.64.187', '111.125.245.79', '112.133.198.46', '112.133.198.188', '112.133.229.29', '112.133.243.242', '113.193.97.169', '113.193.100.164', '113.193.107.128', '114.79.148.153', '114.79.162.145', '114.143.198.2', '114.143.244.242', '115.98.145.199', '115.108.33.74', '115.117.138.159', '115.117.177.80', '115.118.181.184', '115.118.183.161', '115.184.195.103', '115.184.207.99', '115.184.229.77', '115.184.231.6', '115.184.239.162', '115.241.6.240', '115.241.90.250', '115.242.233.230', '115.242.243.130', '115.245.2.173', '115.245.41.22', '115.247.124.32', '115.248.7.13', '115.248.19.166', '115.248.54.121', '115.248.122.13', '115.248.123.77', '115.248.136.98', '115.248.191.25', '115.248.253.41', '115.249.36.117', '115.249.214.61', '115.250.91.128', '115.250.134.74', '115.250.141.120', '115.251.34.199', '116.72.90.163', '116.74.214.103', '116.74.218.18', '116.202.36.65', '116.202.36.85', '116.202.38.179', '116.202.95.92', '116.202.97.117', '116.202.99.253', '116.202.117.70', '116.202.133.208', '116.202.192.113', '116.203.12.155', '116.203.78.144', '116.203.78.213', '117.55.242.3', '117.55.243.14', '117.192.163.207', '117.192.193.96', '117.192.212.20', '117.193.39.180', '117.193.134.75', '117.194.33.202', '117.195.152.234', '117.195.178.242', '117.196.24.50', '117.196.205.128', '117.196.212.89', '117.197.213.15', '117.197.219.101', '117.197.223.132', '117.198.36.175', '117.198.81.186', '117.198.180.102', '117.199.41.80', '117.199.45.79', '117.199.151.134', '117.199.252.187', '117.200.177.159', '117.200.243.32', '117.200.255.73', '117.202.20.14', '117.202.28.226', '117.204.27.156', '117.204.129.116', '117.204.174.222', '117.206.41.192', '117.206.50.123', '117.206.124.190', '117.206.127.247', '117.206.227.100', '117.208.28.138', '117.208.195.152', '117.211.26.84', '117.211.49.31', '117.211.56.103', '117.211.56.134', '117.211.61.14', '117.211.63.39', '117.211.76.21', '117.211.76.27', '117.211.77.2', '117.211.77.7', '117.211.83.6', '117.211.86.108', '117.211.105.10', '117.211.105.15', '117.211.106.6', '117.211.106.227', '117.211.106.228', '117.211.106.229', '117.211.128.6', '117.211.128.19', '117.211.128.33', '117.211.128.35', '117.211.128.51', '117.211.128.62', '117.211.128.90', '117.211.149.76', '117.211.161.67', '117.211.161.150', '117.211.161.243', '117.211.166.121', '117.211.191.205', '117.215.54.198', '117.215.170.186', '117.215.182.130', '117.215.194.1', '117.215.247.90', '117.216.182.147', '117.216.208.213', '117.216.231.66', '117.216.233.61', '117.216.233.245', '117.217.93.12', '117.217.190.224', '117.218.231.11', '117.220.224.120', '117.221.84.40', '117.221.197.222', '117.221.240.199', '117.221.241.206', '117.223.181.60', '117.226.205.52', '117.228.27.28', '117.228.57.54', '117.228.64.31', '117.228.77.206', '117.228.123.129', '117.229.12.175', '117.229.23.208', '117.229.35.120', '117.229.87.16', '117.231.51.28', '117.231.166.214', '117.233.32.186', '117.233.254.200', '117.236.178.126', '117.236.183.80', '117.239.14.20', '117.239.14.22', '117.239.14.81', '117.239.46.146', '117.239.47.98', '117.239.47.176', '117.239.78.56', '117.239.140.130', '117.239.202.82', '117.239.243.230', '117.240.187.35', '117.240.190.114', '117.240.212.178', '117.240.212.194', '117.240.213.99', '117.240.219.226', '117.240.224.78', '117.241.80.237', '117.241.203.79', '117.242.19.75', '117.245.149.154', '117.246.193.87', '117.247.233.12', '117.248.12.81', '117.248.15.97', '117.248.38.29', '117.248.94.24', '117.248.208.58', '117.248.243.62', '117.248.254.226', '117.250.134.254', '117.252.55.133', '117.252.236.65', '118.91.234.32', '118.91.234.78', '119.160.195.148', '119.226.42.182', '119.226.116.42', '119.226.116.46', '119.235.52.22', '120.56.207.230', '120.61.14.203', '120.61.38.191', '120.62.183.117', '120.138.109.114', '121.200.55.35', '121.245.143.53', '122.15.201.20', '122.161.29.174', '122.161.124.199', '122.163.226.8', '122.163.232.82', '122.164.1.206', '122.167.227.38', '122.168.220.223', '122.172.151.39', '122.174.182.191', '122.174.187.98', '122.175.21.136', '122.175.139.57', '122.175.167.108', '122.175.200.110', '122.175.243.158', '122.177.68.82', '122.177.77.97', '122.177.228.115', '122.178.113.253', '122.179.94.190', '122.179.95.177', '123.63.59.42', '123.63.171.26', '123.201.178.159', '123.201.200.192', '123.239.68.199', '123.239.69.235', '123.252.204.26', '124.30.250.188', '124.123.6.29', '124.123.77.192', '124.123.78.63', '124.123.81.219', '124.123.91.135', '124.123.160.231', '124.123.177.70', '124.124.23.162', '124.124.23.163', '124.124.47.116', '124.124.111.33', '124.124.193.134', '124.125.64.121', '124.155.252.217', '125.19.102.2', '125.99.120.242', '136.185.252.63', '139.162.42.48', '150.107.241.49', '150.129.31.210', '150.129.133.134', '150.129.144.98', '150.129.145.122', '159.203.40.250', '163.47.14.198', '163.47.15.99', '163.47.15.129', '168.235.197.212', '168.235.207.58', '168.235.207.100', '168.235.207.249', '171.49.150.28', '171.51.164.188', '171.51.182.95', '171.61.28.23', '171.76.163.16', '175.101.15.12', '175.101.16.193', '175.101.19.27', '178.79.140.49', '180.151.120.18', '180.215.33.98', '180.215.121.134', '180.215.122.133', '180.215.122.200', '182.18.177.242', '182.19.8.82', '182.19.48.18', '182.19.73.228', '182.48.197.7', '182.48.238.37', '182.57.92.71', '182.57.204.119', '182.59.204.235', '182.66.53.222', '182.68.253.8', '182.71.178.188', '182.71.178.190', '182.72.217.77', '182.73.121.234', '182.73.127.2', '182.75.223.234', '182.77.14.60', '182.156.160.236', '183.82.198.200', '183.82.201.39', '183.82.224.249', '183.83.51.193', '183.83.230.88', '183.87.44.45', '183.87.102.171', '183.87.252.194', '183.182.85.18', '188.166.25.25', '188.166.87.191', '188.166.91.5', '188.166.121.88', '199.115.117.235', '202.71.141.138', '202.78.234.245', '202.83.32.36', '202.88.252.51', '202.129.209.3', '202.129.209.130', '202.129.241.237', '202.133.60.242', '202.134.175.26', '202.142.113.243', '202.153.41.35', '202.153.41.37', '202.191.156.124', '203.88.23.38', '203.90.92.80', '203.115.106.98', '203.115.106.102', '203.129.195.130', '203.188.231.165', '203.192.204.141', '203.192.213.29', '203.196.133.98', '203.197.87.94', '203.201.61.158', '203.212.202.129', '210.212.152.83', '210.212.170.66', '210.212.171.169', '210.212.172.99', '210.212.172.179', '210.212.172.209', '210.212.172.214', '210.212.183.59', '210.212.188.162', '210.212.203.66', '210.212.238.115', '210.212.242.166', '218.248.4.101', '218.248.13.196', '218.248.13.209', '218.248.43.105', '219.64.176.112', '219.90.101.175', '220.156.187.4', '220.156.187.71', '220.225.53.123', '220.225.78.66', '220.225.78.67', '220.227.57.45', '220.227.219.137', '223.30.49.86', '223.31.25.66', '223.176.10.130', '223.176.20.156', '223.176.36.202', '223.176.166.109', '223.176.184.226', '223.180.250.147', '223.196.18.61', '223.196.86.227', '223.196.86.228', '223.196.97.78', '223.196.171.180', '223.196.191.131', '223.227.57.120', '223.227.161.208', '223.227.241.236', '223.228.255.35', '223.231.17.253', '223.235.195.85', '223.236.215.153', '223.255.247.194']

tupleLocation = ()
COUNTRY_NAME='India'

with open('dbip-city-2017-07.csv', 'rb') as csvfile:
    cityipreader = csv.reader(csvfile, delimiter=',', quotechar='"')
    matched_ip = []
    for array in cityipreader:
        to_addr = netaddr.IPAddress(array[1])
        print to_addr
        from_addr = netaddr.IPAddress(array[0])
        print from_addr
        
        for i in unique_ip:
         if netaddr.IPAddress(i) in netaddr.IPSet(netaddr.IPRange(from_addr,to_addr)):
           print "YEA"
           country_code = array[2]
           state_name = array[3]
           city_name = array[4]
           print "Country {} State {} City {}".format(country_code, state_name,city_name)
           matched_ip.append(i)
           matched_ip.append(country_code)
           matched_ip.append(state_name)
           matched_ip.append(city_name)
           print matched_ip
           continue

with open("All_Global_ip.txt", "w") as outfile:
    outfile.write(''.join(matched_ip))

end_time = datetime.now()
print('Duration: {}'.format(end_time - start_time))
